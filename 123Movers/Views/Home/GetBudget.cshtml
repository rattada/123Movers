@model _123Movers.Models.SearchModel
@using _123Movers.Models;

@{
    ViewBag.Title = "GetBudget";
    Layout = "~/Views/Shared/_Layout.cshtml";
   
}

<script type="text/javascript" src="~/Scripts/jquery.tablesorter.min.js"></script>
 <div class="row">
     @Html.Partial("_CompanyInfo", @Model.budget.FirstOrDefault())
                </div>
 <p class="clearfix"></p>
@if (@Model != null)
{
        <h2>Active Budgets</h2> 
    
     <div class="row">
         <div class="col-md-12">
             @*<input type="button" id ="AddBudget" class="button" value="Add Budget" />*@
  <p>  @Html.ActionLink("Add a Budget", "AddBudget", "Home", new { companyid = @Model.CompanyId, companyName = @Model.CompanyName, ax = @Model.AX, active = @Model.IsActive, displayname = @Model.DisplayName, contactperson = @Model.ContactPerson, companyHandle=@Model.CompanyHandle }, new {id = "AddBudget", @class = "btn btn-primary btn-lg btn-warning" })</p>
             </div>
     </div>
    <div class="table-responsive">
    <table id="ActiveInfo" class="table table-striped table-bordered">
      <thead>
        <tr>
            <th>
                Insertion Order Id
            </th>

            <th>
                Start Date
            </th>

            <th>
               Budget Amount
            </th>

            <th>
                Remaining Budget
            </th>
            <th>
                Terms
            </th>
            <th>
                Sevice
            </th>
            <th>
                Filters
            </th>
        </tr>
          </thead>
          <tbody>
               
            @{
           // DateTime currentDate = DateTime.UtcNow;
             List<BudgetModel> activeBudget = Model.budget.Where(c => c.EndDate >= DateTime.Now || c.EndDate == null || c.RemainingBudget > 0).ToList();
           // List<BudgetModel> activeBudget = Model.budget.Where(c => c.RemainingBudget > 0).ToList();
                }   
            @if (activeBudget.Count > 0)
            {
                foreach (var lot in activeBudget)
                {
           
          
            <tr>
                <td>
                    @lot.InsertionOrderId
                </td>

                <td>
                    @{
                     var sdate = @lot.StartDate.HasValue ? @DateTime.Parse(@lot.StartDate.ToString()).ToShortDateString() : null;
                     }
                  @sdate
                </td>
                
                <td>
                    @string.Format("{0:c}", @lot.TotalBudget)
                </td>

                <td>
                   @string.Format("{0:c}", @lot.RemainingBudget)
                </td>

                <td>
                    @{
                    var Recurring = (@lot.IsRecurring) ? (@lot.IsRequireNoticeToCharge) ? "Recurring With Notice" : "Recurring" : "Non Recurring";
                    
                    }
                    @Recurring
               </td>
                 <td>
                    @{
                        var Service = (@lot.ServiceId == 1009) ? "Local" : (@lot.ServiceId == 1000) ? "Long" : "Both";
                    
                    }
                    @Service
               </td>

                <td>
           <p> @Html.ActionLink("Edit", "EditBudget", "Home", new { TotalBudget =@lot.TotalBudget,IsRecurring =@lot.IsRecurring, IsRequireNoticeToCharge = @lot.IsRequireNoticeToCharge,ServiceId =@lot.ServiceId, agnumber=@lot.AgreementNumber,minDaysToCharge =@lot.MinDaysToCharge}, new {id = "EditBudget", @class = "btn btn-sm btn-primary" })</p>
                               
                </td>
            </tr>
            
                }
            }
            else
            {
                <tr>
                <td class="col-md-6 text-center" colspan="10">No Active Bugdets found
                </td>
            </tr>
            }

       
               </tbody>
    </table>
        </div>
    
    
        <h2>Expired Budgets</h2> 
     
    <div class="row">
        <div class="col-md-6">
             <p>  <strong>Total Billed :</strong> @ViewBag.TotalBilled</p>
            </div>
            <div class="col-md-6">
              <p> <strong>Total Uncharged :</strong> @ViewBag.UnchargedAmount</p>
          </div>
     </div>
  
  
    <div class="table-responsive">
    <table id="ExpiredInfo" class="table table-striped table-bordered tablesorter">
    <thead>
        <tr>
            <th>  Insertion Order ID
            </th>

            <th>
                Start Date
            </th>

            <th>
               End Date
            </th>

            <th>
                Total Budget
            </th>
            <th>
               Uncharged Amount
            </th>
            <th>
               Terms
            </th>
            <th>
                Sevice
            </th>
            <th>
                Filters
            </th>
        </tr>
         </thead>
          <tbody>
        
            @{
    //List<BudgetModel> expiredBudget = Model.budget.Where(c => c.EndDate < DateTime.Now ).ToList();
             List<BudgetModel> expiredBudget = Model.budget.Where(c => c.EndDate < DateTime.Now || c.UnchargedAmount <= 0 || c.RemainingBudget <= 0).ToList();
           // List<BudgetModel> expiredBudget = Model.budget.Where(c => c.RemainingBudget <= 0).ToList();
                } 
            @if (expiredBudget.Count > 0)
            {
                foreach (var lot in expiredBudget)
                {
               
            <tr>
                <td>
                    @lot.InsertionOrderId
                </td>

                <td>
                    @{
                     var sdate = @lot.StartDate.HasValue ? @DateTime.Parse(@lot.StartDate.ToString()).ToShortDateString() : null;
                     }
                  @sdate
                </td>
                
                <td>
                    @{
                       
                    var edate = @lot.EndDate.HasValue ? @DateTime.Parse(@lot.EndDate.ToString()).ToShortDateString() : null;
                    }
                   @edate
                </td>

                <td>
                   @string.Format("{0:c}", @lot.TotalBudget)
                </td>

                <td>
                     @string.Format("{0:c}", @lot.UnchargedAmount)
                </td>

               <td>
                   @{
                    var Recurring = (@lot.IsRecurring) ? (@lot.IsRequireNoticeToCharge) ? "Recurring With Notice" : "Recurring" : "Non Recurring";
                    
                    }
                    @Recurring
               </td>
                 <td>
                    @{
                        var Service = (@lot.ServiceId == 1009) ? "Local" : (@lot.ServiceId == 1000) ? "Long" : "Both";
                    
                    }
                    @Service
               </td>


                <td>
                             
                </td>
            </tr>
                
                }
            }
             else
        {
            <tr>
                <td colspan="10" class="text-center">No Exipred Bugdets found
                </td>
            </tr>
        }

        
       
              </tbody>
    </table>
        </div>
         
    
}

@* <div class="Container">
 <p class="button">@Html.ActionLink("Back to List", "history.go(-1);return false;")</p>
</div>*@
<a href="#" onclick="history.go(-1);return false;" class="btn btn-primary">BACK TO LIST</a> 

<script type="text/javascript">
    $(document).ready(function () {
        $("#ExpiredInfo").tablesorter();
        //var count = $('#ActiveInfo>tbody>tr').length;
        //var count1 = $('#ExpiredInfo>tbody>tr').length;
        //alert(count1);
        //if (count <= 0) {
        //    $('#empty').attr('style', 'display:none')
        //}
        

      @*  $("#AddBudget").click(function () {

            var search = {
                CompanyId: @Model.CompanyId,
                    CompanyName: @Model.CompanyName,
            ContactPerson: @Model.ContactPerson,
            AX: @Model.AX
              
        };

            var car = { CompanyId: @Model.CompanyId, Model: 'A4 Avant', Colour: 'Black', Registered: 2013 };
              $.ajax({
                url: '/Home/AddBudget',
                type: 'GET',
                dataType: 'json',
                traditional: true,
                data: $("#form").serialize(),
                success: function () {
                    //reordered = false;
                    //$('#saveOrder').removeClass('Save').addClass('Disabled').unbind('click');
                    //$("body").unmask();
                    //Dominion.Cms.Common.showSuccessMessage("#cmsMessage", "Coupon order saved successfully.");
                },
                error: function () {
                    //$("body").unmask();
                    //Dominion.Cms.Common.showErrorMessage("#cmsMessage", "There was an error saving the coupon order. Please try again.");
                }
            });
        });*@


    });
</script>