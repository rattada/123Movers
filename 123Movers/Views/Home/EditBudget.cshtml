@model _123Movers.Models.BudgetModel

@{
    ViewBag.Title = "Edit Budget";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var IsActive = (@Model.IsActive) ? "Active" : "Expired";
}
<script type="text/javascript" src="~/Scripts/jquery-ui-1.10.4.min.js"></script>
@*<script src="~/Scripts/jstree.js" type="text/javascript"></script>*@


@Html.AntiForgeryToken()
@Html.ValidationSummary(true)

<input type="hidden" id="message" value="@ViewBag.Success"/>

<div class="row">

    @Html.Partial("_CompanyInfo")

</div>
@using (Html.BeginForm("EditBudget", "Home", FormMethod.Post, new { id = "frmeditbudget" }))
{

    <p class="clearfix"></p>
    <div class="row">
        <div class="col-lg-4">
            <div class="form-group">
                @Html.LabelFor(m => m.TotalBudget)
                @Html.TextBoxFor(m => m.TotalBudget, new { @class = "form-control", @readonly = "readonly", Value = String.Format("{0:0.00}", Model.TotalBudget) })
                @Html.ValidationMessageFor(m => m.TotalBudget)
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.AgreementNumber)
                @Html.TextBoxFor(m => m.AgreementNumber, new { @class = "form-control" })
                @Html.ValidationMessageFor(m => m.AgreementNumber)
            </div>

        </div>
        <div class="col-lg-4">
            <div class="form-group">
                @Html.LabelFor(m => m.TermType)
                @Html.DropDownListFor(m => m.TermType, ViewBag.Terms as IEnumerable<SelectListItem>, new { @class = "form-control dropdown", @title = "Select Terms" })
                @Html.ValidationMessageFor(m => m.TermType)
            </div>

            <div class="form-group">
                @Html.LabelFor(m => m.ServiceId)
                @Html.DropDownListFor(m => m.ServiceId, ViewBag.Services as IEnumerable<SelectListItem>, new { id = "services", @class = "form-control dropdown", @title = "Select Services" })
                @Html.ValidationMessageFor(m => m.ServiceId)
            </div>
        </div>
        <div class="col-lg-4">
            <div class="form-group">
                @Html.LabelFor(m => m.MinDaysToCharge)
                @Html.TextBoxFor(m => m.MinDaysToCharge, new { @class = "form-control" })
                @Html.ValidationMessageFor(m => m.MinDaysToCharge)
            </div>

            <p class="clearfix"></p>
            <p class="clearfix"></p>
            <p class="clearfix"></p>
            @* <div class="form-group">
                @Html.ActionLink("Manage Area Codes", "ManageAreaCodes", "Home", new { companyid = @Model.CompanyId, serviceId = @Model.ServiceId, companyName = @Model.CompanyName }, new { id = "managearea", @class = "btn btn-primary pull-right" })

                @Html.ActionLink("Manage Lead Limit", "CompanyLeadLimit", "Home", new { companyid = @Model.CompanyId, serviceId = @Model.ServiceId, companyName = @Model.CompanyName }, new { id = "leadlimit", @class = "btn btn-primary" })
            </div>*@
        </div>
    </div>
   
 var Service = (@Model.ServiceId == 1009) ? "1009" : (@Model.ServiceId == 1000) ? "1000" : null;
    <div class="row">
       <div class="col-md-12">
           @Html.ActionLink("Manage Area Codes", "ManageAreaCodes", "Home", new { companyid = @Model.CompanyId, serviceId = Service, companyName = @Model.CompanyName }, new { id = "managearea", @class = "btn btn-default" })
           @Html.ActionLink("Manage Lead Limit", "CompanyLeadLimit", "Home", new { companyid = @Model.CompanyId, serviceId = Service, companyName = @Model.CompanyName }, new { id = "leadlimit", @class = "btn btn-default" })
           @Html.ActionLink("Manage Origin", "Geography", "Home", new { companyid = @Model.CompanyId, serviceId = Service}, new { id = "geography", @class = "btn btn-default" })
           @Html.ActionLink("Manage Destination", "DestinationZipCodes", "Home", new { companyid = @Model.CompanyId, serviceId = Service }, new { id = "destzipcodes", @class = "btn btn-default" })
           @Html.ActionLink("Manage Distance", "Distance", "Home", new { companyid = @Model.CompanyId, serviceId = Service }, new { id = "distance", @class = "btn btn-default" })
           @Html.ActionLink("Manage Move Weight", "MoveWeight", "Home", new { serviceId = Service }, new { id = "movewight", @class = "btn btn-default" })
       </div>
   </div>

           
            
    
@*<div class="row">
        <div class="col-md-12">
            <div class="checkbox">
                <label>
                    <input type="checkbox" id="service" />Filters
                </label>
            </div>
        </div>
    </div>
    <div class="row">
        <div id="filters">
        </div>
    </div>
    
    
    <div class="row">
        <div class="col-md-6">
            <a href="#" onclick="history.go(-1);return false;" class="btn btn-primary">Back To List</a>
        </div>
        <div class="col-md-6">
            <input type="submit" value="Save Budget" id="save" class="btn btn-primary pull-right">
        </div>
    </div>*@
    
    <div class="row">
        <input type="submit" id="save" class="btn btn-primary pull-right" value="Save Budget" />
        <a href="#" onclick="history.go(-1);return false;" class="btn btn-primary btnSpacing">Back To List</a>
    </div>
}

<script type="text/javascript">


    $(function () {
        // var strigifyJsonViewBag = @Html.Raw(ViewBag.MoveWeights);

        var message = $.trim($('#message').val());
        if (typeof message === 'undefined' || message.length <= 0) { } else { alert(message); }

        var ddlservice = $("#services").val();
        var ServiceId = (ddlservice == 1009) ? "1009" : (ddlservice == 1000) ? "1000" : null;

        $.ajax({
            url: '/Home/GetFilterResult',
            type: "GET",
            data: { 'serviceId': ServiceId },
            dataType: "json",
            cache: false,
            success: function (data) {
                var strigifyJson = JSON.stringify(data);
                var json = $.parseJSON(strigifyJson);

                jQuery.each(json, function (i, val) {
                    var ID = val[0];
                    var value = val[2];

                    if (ID == 1 && val[2] == "True") {

                        $('#managearea').removeClass('btn-default');
                        $('#managearea').addClass('btn-warning');
                    }
                    else
                        if (ID == 2 && val[2] == "True") {
                            $('#destzipcodes').removeClass('btn-default');
                            $('#destzipcodes').addClass('btn-warning');
                        }

                        else if (ID == 3 && val[2] == "True") {
                            $('#distance').removeClass('btn-default');
                            $('#distance').addClass('btn-warning');
                        }
                        else
                            if (ID == 4 && val[2] == "True") {
                                $('#leadlimit').removeClass('btn-default');
                                $('#leadlimit').addClass('btn-warning');
                            }

                            else
                                if (ID == 5 && val[2] == "True") {
                                    $('#movewight').removeClass('btn-default');
                                    $('#movewight').addClass('btn-warning');
                                }
                                else
                                    if (ID == 6 && val[2] == "True") {
                                        $('#geography').removeClass('btn-default');
                                        $('#geography').addClass('btn-warning');

                                    }

                });



            },
            error: function (xhr, ajaxOptions, thrownError) {

            }
        });

        $('#service').on('change', function () {
            if (this.checked) {

                $.ajax({
                    url: '/Home/GetServices',
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        var strigifyJson = JSON.stringify(data);
                        var json = $.parseJSON(strigifyJson);

                        var table;



                        table = "<div class='panel-group' id='accordion'> <div class='panel panel-default'><div class='panel-heading'><h4 class='panel-title'>  <a data-toggle='collapse' data-parent='#accordion' href='#collapseAreaCode'>Geography <span class='glyphicon glyphicon-minus pull-right'></span></a></h4></div><div id='collapseAreaCode' class='panel-collapse collapse in'><div class='panel-body'>        <div class='container-fluid'><div class='row'><div class='col-sm-3 col-md-2 sidebar'><ul class='nav nav-sidebar'><li><a href='#divGeographyInfo' id='anchorOrigin' class='btn btn-warning'>Origin</a></li><li><a href='#divGeographyInfo' id='anchorDestination' >Destination</a></li></ul></div><div class='col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main'>                  <div class='scrollable-table page-header' id='divGeographyInfo'><div class = 'col-md-3'><table class='table table-striped'><thead><tr><th class='col-md-1'>Select</th><th class='col-md-2'>" + 'Area Code' + "</th></tr> </thead><tbody>";
                        jQuery.each(json, function (i, val) {
                            if (i <= 57) {
                                table += "<tr><td><input type='checkbox' id='chk" + val[0] + "' class='checkbox' /> </td><td> <span> " + val[1] + " ---> " + val[0] + "</span>     </td></tr>";
                            }
                        });
                        table += "</tbody></table></div>";

                        var table1 = "<div class = 'col-md-3'><table class='table table-striped'><thead><tr><th class='col-md-1'>Select</th><th class='col-md-2'>" + 'Area Code' + "</th></tr> </thead><tbody>";
                        jQuery.each(json, function (i, val) {
                            if (i >= 58 && i <= 115) {
                                table1 += "<tr><td><input type='checkbox' id='chk" + val[0] + "' class='checkbox' /> </td><td><span>" + val[1] + " ---> " + val[0] + "</span>   </td></tr>";
                            }
                        });
                        table1 += "</tbody></table></div>";

                        var table2 = "<div class = 'col-md-3'><table class='table table-striped'><thead><tr><th class='col-md-1'>Select</th><th class='col-md-2'>" + 'Area Code' + "</th></tr> </thead><tbody>";
                        jQuery.each(json, function (i, val) {
                            if (i >= 116 && i <= 173) {
                                table2 += "<tr><td><input type='checkbox' id='chk" + val[0] + "' class='checkbox' /> </td><td><span>" + val[1] + " ---> " + val[0] + "</span> </td></tr>";
                            }
                        });
                        table2 += "</tbody></table></div>";

                        var table3 = "<div class = 'col-md-3'><table class='table table-striped'><thead><tr><th class='col-md-1'>Select</th><th class='col-md-2'>" + 'Area Code' + "</th></tr> </thead><tbody>";
                        jQuery.each(json, function (i, val) {
                            if (i >= 174 && i < json.length) {
                                table3 += "<tr><td><input type='checkbox' id='chk" + val[0] + "' class='checkbox' /> </td><td><span>" + val[1] + " ---> " + val[0] + "</span> </td></tr>";
                            }
                        });
                        table3 += "</tbody></table></div></div></div></div></div><input type='button' id='btnGeography' class='btn pull-right btn-warning btn-lg' value='Save' />  </div></div></div> ";

                        table += table1 + table2 + table3;



                        var tableNew;
                        tableNew = "<div class='panel panel-default'><div class='panel-heading'><h4 class='panel-title'><a data-toggle='collapse' data-parent='#accordion' href='#collapseTwo'># Of LEADS per day<span class='glyphicon glyphicon-plus pull-right'></span></a></h4></div><div id='collapseTwo' class='panel-collapse collapse'><div class='panel-body'> Need to Add Leads filter Information here. </div> </div></div>";


                        var tableNew2;
                        tableNew2 = "<div class='panel panel-default'><div class='panel-heading'><h4 class='panel-title'><a data-toggle='collapse' data-parent='#accordion' href='#collapseThree'>Distance <span class='glyphicon glyphicon-plus pull-right'></span></a></h4></div><div id='collapseThree' class='panel-collapse collapse'><div class='panel-body'><div class='row'><table id='tblDistance' class='table table-striped table-bordered'><thead><tr><th >Service</th> <th>Minimum Weight </th><th>Maximum Weight</th> </tr> </thead><tbody><tr> <td><select id='ddlServiceID'><option value=''>---Choose one---</option><option value='1009'>Local</option><option value='1000'>Long</option></select></td><td><input type='text' id='txtMinWeight' value='0'><span id='lblMin' class='errmsg'></span></td><td><input type='text' id='txtMaxWeight' value='0'><span  id='lblMax' class='errmsg'></span></td> </tr> </tbody></table></div><div class='col-md-12'> <input type='button' value='Save Distance' id='saveDistance' class='btn btn-primary pull-right'> </div>  </div></div></div>";

                        var tableNew3;
                        tableNew3 = "<div class='panel panel-default'><div class='panel-heading'><h4 class='panel-title'><a data-toggle='collapse' data-parent='#accordion' href='#collapseFour'>Day of the Week <span class='glyphicon glyphicon-plus pull-right'></span></a></h4></div><div id='collapseFour' class='panel-collapse collapse'><div class='panel-body'> Nedd to Add Day of the Week  filter Information here. </div> </div></div>";


                        var tableNew4;
                        tableNew4 = "<div class='panel panel-default'><div class='panel-heading'><h4 class='panel-title'><a data-toggle='collapse' data-parent='#accordion' href='#collapseFive'>Weight/Size<span class='glyphicon glyphicon-plus pull-right'></span></a></h4></div><div id='collapseFive' class='panel-collapse collapse'><div class='panel-body'><div class='row'><table id='tblMoveWeight' class='table table-striped table-bordered'><thead><tr><th >Service</th> <th>Minimum Weight </th><th>Maximum Weight</th> </tr> </thead><tbody><tr> <td><select id='ddlWeightID'><option value=''>---Choose one---</option><option value='1009'>Local</option><option value='1000'>Long</option></select></td><td><select id='ddlMinWeightID'><option value=''>---Choose one---</option></select></td><td><select id='ddlMaxWeightID'><option value=''>---Choose one---</option></select></td> </tr> </tbody></table></div><div class='col-md-12'> <input type='button' value='Save Distance' id='saveDistance' class='btn btn-primary pull-right'> </div>  </div> </div></div>";

                        table += tableNew + tableNew2 + tableNew3 + tableNew4;

                        $("#filters").html(table);




                    },
                    error: function (xhr, ajaxOptions, thrownError) {

                    }
                });

                

            }
            else {
                $("#filters").html('');
            }
        });


        $("body").parent().on('click', "a", function () {

            if ($(this).attr('id') == 'anchorOrigin' || $(this).attr('id') == 'anchorDestination') {
                if ($(this).attr('id') == 'anchorOrigin') {
                    $(this).addClass("btn btn-warning");
                    $('#anchorDestination').removeClass("btn btn-warning");
                    $('input:checkbox').removeAttr('checked');
                }
                else {
                    $('#anchorDestination').addClass("btn btn-warning");
                    $('#anchorOrigin').removeClass("btn btn-warning");
                    $('input:checkbox').removeAttr('checked');

                }


            }

            if ($(this).children().hasClass('glyphicon glyphicon-plus')) {
                $(this).children().removeClass("glyphicon glyphicon-plus");
                $(this).children().addClass("glyphicon glyphicon-minus");

            }
            else {

                $(this).children().removeClass("glyphicon glyphicon-minus");
                $(this).children().addClass("glyphicon glyphicon-plus");

            }
        });


        $("body").parent().on('click', "#btnGeography", function () {
            var IsOrigin = '';
            if ($('#anchorDestination').hasClass("btn btn-warning")) {
                IsOrigin = 0;
            }
            else {
                IsOrigin = 1;
            }

            var areacodes = [];
            $('table tbody tr').each(function () {
                $(this).find('input:checkbox:checked').each(function () {

                    var textBoxValue = $(this).closest('tr').find('span').text();
                    var areaCode = textBoxValue.split('--->');
                    areacodes.push(areaCode[1]);

                });
            });

            var jsareacodes = JSON.stringify(areacodes);
            var serviceId = $('#services').val();

            $.ajax({
                url: '/Home/AddCompanyZipCodesPerAreaCodes',
                type: "POST",
                data: { 'serviceId': serviceId, areaCodes: jsareacodes, "IsOrigin": IsOrigin },
                success: function (data) {
                    if (data.success === true) {
                        alert('AreaCodes Saved Suceessfully');
                        //$("#btnGeography").attr('disabled', 'disabled');
                    } else {
                        alert("Error :" + data.message);
                    }

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    var errMessage = JSON.parse(xhr.responseText).customErrorMessage;
                    alert('Error occurred while saving the AreaCodes' + errMessage);
                }
            });

        });



        $("body").parent().on('click', "#saveDistance", function () {

            var serviceId = $('#ddlServiceID').val();
            var MinWeight = $("#txtMinWeight").val();
            var MaxWeight = $("#txtMaxWeight").val();

            if (serviceId != $("#services").val()) {
                alert('Please choose right  Service Type');
                $('#ddlServiceID').focus();
                return false;

            }

            if (serviceId == '' || serviceId == null) {
                alert('Please choose any Service Type');
                $('#ddlServiceID').focus();
                return false;
            }
            if (serviceId != null && serviceId != '') {

                if ($("#txtMinWeight").val().length == 0 && $("#txtMaxWeight").val().length == 0) {
                    alert('Please enter atleast one Weight');
                    return false;

                }




                $.ajax({
                    url: '/Home/AddCompanyMoveDistance',
                    type: "POST",
                    data: { 'ServiceId': serviceId, 'MinWeight': MinWeight, "MaxWeight": MaxWeight },
                    success: function (data) {
                        alert('Move Distance  Saved Suceessfully');
                        // $("#service").attr("checked", false);

                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        var errMessage = JSON.parse(xhr.responseText).customErrorMessage;
                        alert('Error occurred while saving the AreaCodes' + errMessage);
                    }


                });

            }
        });


        $("body").parent().on('keypress', "#txtMinWeight", function (e) {

            //if the letter is not digit then display error and don't type anything
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                //display error message
                $("#lblMin.errmsg").html("Digits Only").show().fadeOut("slow");
                return false;
            }
        });

        $("body").parent().on('keypress', "#txtMaxWeight", function (e) {

            //if the letter is not digit then display error and don't type anything
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                //display error message
                $("#lblMax.errmsg").html("Digits Only").show().fadeOut("slow");
                return false;
            }
        });
    });


</script>
