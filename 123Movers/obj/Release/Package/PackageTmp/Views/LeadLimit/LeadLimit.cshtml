@model _123Movers.Models.LeadLimitModel
@using _123Movers.Models
@{
    ViewBag.Title = "Company Lead Limit";
  }

<input type="hidden" id="message" value="@ViewBag.Success"/>
<input type="hidden" id="hdnServiceId" value="@ViewBag.ServiceID"/>


    @Html.Partial(Constants.VIEW, @Model._companyInfo)
@section JavaScript{
    @Html.Script("leadLimit.js")
 }


<p class="clearfix"></p>
@*@using (Html.BeginForm("CompanyLeadLimit", "Home", FormMethod.Post, new { id = "frmLeadLimit" }))
{  *@
@Html.AntiForgeryToken()
@Html.ValidationSummary(true)

<div class="table-responsive" id="divLeadlimit">
    <table id="tblLeadLimit" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th class="text-center" id="tdSelect">Select</th>
                <th class="text-center">Service
                </th>

                <th class="text-center">AreaCode
                </th>

                <th class="text-center">Frequency
                </th>

                <th class="text-center">Daily Limit
                </th>
                <th class="text-center">Monthly Limit
                </th>
                <th class="text-center">Total Limit
                </th>

            </tr>
        </thead>
        <tbody>
            @{
                if (@Model.LeadLimitData != null)
                {
                    if (@Model.LeadLimitData.Count() > 0)
                    {
                        var bothservice = Model.LeadLimitData.Where(x => x.ServiceId==null).SingleOrDefault();

                        if (bothservice != null)
                        {

                            
                            
                <tr>
                    <td class="text-center">
                        <input type="checkbox" class='chkSelectClass' id="rdbtnboth"></td>
                    <td id="tdBoth1" class="text-center">@Constants.BOTH_TEXT
                    </td>
                    <td class="text-center">@Constants.DEFAULT
                    </td>
                    <td class="text-center">
                        <input type="text" id="txtFrequencyboth" class="leadLimit-control text-center freqEnable " value="@bothservice.LeadFrequency" disabled="disabled" >
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkDailyBoth" class="chkInnerClass" checked="@bothservice.IsDailyLeadLimit">
                        Daily Lead Limit :
                        <input type="text" id="txtDailyBoth" disabled="disabled" class="classCheckVal  text-center leadLimit-control"  value="@bothservice.DailyLeadLimit" ><br>
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkMonthlyBoth" class="chkInnerClass" checked="@bothservice.IsMonthlyLeadLimit">
                        Monthly Lead Limit :
                        <input type="text" id="txtMonthlyBoth" disabled="disabled" class="classCheckVal  text-center leadLimit-control" value="@bothservice.MonthlyLeadLimit" ><br>
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkTotalBoth" class="chkInnerClass" checked="@bothservice.IsTotalLeadLimit">
                        Total Lead Limit :
                        <input type="text" id="txtTotalBoth" disabled="disabled" class="classCheckVal  text-center leadLimit-control" value="@bothservice.TotalLeadLimit" ><br>
                    </td>

                </tr>
                
                <tr>
                    <td class="col-md-6 text-center" colspan="7">----OR----
                    </td>
                </tr>
                        }



                        var services = Model.LeadLimitData.Where(x => (x.ServiceId == Constants.LOCAL || x.ServiceId == Constants.LONG) && x.AreaCodes == null).OrderByDescending(x => x.ServiceId).ToList();
                        if (services.Count > 0)
                        {
                            foreach (var service in services)
                            {
                <tr>
                    <td class="text-center">
                        <input type="checkbox" class="chkSelectClass text-center" id="rdbtn@(service.ServiceId.TernaryLocalLong())"></td>
                    <td id="tdLocalLong" class="text-center">@service.ServiceId.TernaryLocalLong()
                    </td>
                    <td class="text-center">@Constants.DEFAULT
                    </td>
                    <td class="text-center">
                        <input type="text" id="txtFrequency@(service.ServiceId.TernaryLocalLong())" class=" text-center leadLimit-control freqEnable" value="@service.LeadFrequency"  disabled="disabled">
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkDaily@(Constants.DEFAULT)" class="chkInnerClass" checked="@service.IsDailyLeadLimit">
                        Daily Lead Limit :
                        <input type="text" id="txtDaily@(Constants.DEFAULT)" disabled="disabled" class="classCheckVal  text-center leadLimit-control"  value="@service.DailyLeadLimit" ><br>
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkMonthly@(Constants.DEFAULT)" class="chkInnerClass" checked="@service.IsMonthlyLeadLimit">
                        Monthly Lead Limit :
                        <input type="text" id="txtMonthly@(Constants.DEFAULT)" disabled="disabled" class="classCheckVal  text-center leadLimit-control" value="@service.MonthlyLeadLimit" ><br>
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkTotal@(Constants.DEFAULT)" class="chkInnerClass" checked="@service.IsTotalLeadLimit">
                        Total Lead Limit :
                        <input type="text" id="txtTotal@(Constants.DEFAULT)" disabled="disabled" class="classCheckVal  text-center leadLimit-control" value="@service.TotalLeadLimit" ><br>
                    </td>

                </tr>
                            }
                <tr>
                    <td class="col-md-6 text-center" colspan="7">----OR----
                    </td>
                </tr>
                        }


                        var allServices = Model.LeadLimitData.Where(x => x.ServiceId != 0 && x.AreaCodes != null).OrderByDescending(x => x.ServiceId).ToList();
                        if (allServices.Count > 0)
                        {
                            foreach (var service in allServices)
                            {
                               
                                
                <tr>
                    <td class="text-center">
                        <input type="checkbox"  class="chkSelectClass" id="rdbtn@(service.ServiceId.TernaryLocalLong())@(service.AreaCodes)"></td>
                    <td id="tdBoth" class="text-center">@(service.ServiceId.TernaryLocalLong())
                    </td>
                    <td class="text-center">@service.AreaCodes
                    </td>
                    <td class="text-center">
                        <input type="text" id="txtFrequency@(service.ServiceId.TernaryLocalLong())" class=" text-center leadLimit-control freqEnable" value="@service.LeadFrequency"  disabled="disabled">
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkDaily@(service.AreaCodes)" class="chkInnerClass" checked="@service.IsDailyLeadLimit">
                        Daily Lead Limit :
                        <input type="text" id="txtDaily@(service.AreaCodes)" disabled="disabled" class="classCheckVal  text-center leadLimit-control"  value="@service.DailyLeadLimit" ><br>
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkMonthly@(service.AreaCodes)" class="chkInnerClass" checked="@service.IsMonthlyLeadLimit">
                        Monthly Lead Limit :
                        <input type="text" id="txtMonthly@(service.AreaCodes)" disabled="disabled" class="classCheckVal  text-center leadLimit-control" value="@service.MonthlyLeadLimit" ><br>
                    </td>
                    <td class="text-center">
                        <input type="checkbox" id="chkTotal@(service.AreaCodes)" class="chkInnerClass" checked="@service.IsTotalLeadLimit">
                        Total Lead Limit :
                        <input type="text" id="txtTotal@(service.AreaCodes)" disabled="disabled" class="classCheckVal  text-center leadLimit-control" value="@service.TotalLeadLimit" ><br>
                    </td>

                </tr>
                                 
                            }
                        }
                    }

                }
                else
                {<tr>
                    <td class="col-md-6 text-center" colspan="7">----No Records found----
                    </td>
                </tr>}
            }


        </tbody>
    </table>
</div>
<div class="row">
    <input type="button" id="saveleads" class="btn btn-primary pull-right" value="Save Leads" />
    <a href="#" onclick="history.go(-1);return false;" class="btn btn-primary btnSpacing">Back To Edit</a>

</div>

@*}*@

@*<script type="text/javascript">
    $(function () {

        $('#tblLeadLimit tbody tr').each(function () {
            $(this).find(".classCheckVal:input[type=text]").each(function () {

                if ($(this).val() != 0 && $(this).val() != '')
                    $(this).attr("disabled", false);


            });
        });

        $("#saveleads").attr('disabled', true);

        $("body").on("keypress", "input", function (event) {
            var key = event.which;

            if (!(key >= 48 && key <= 57))
                event.preventDefault();
            else
                $("#saveleads").removeAttr('disabled');
        });

        $("#saveleads").click(function () {
            var count = 0;
            var required = "";
            var Array = [];
            var values = "";
            var LeadLimitData = [];
            var Filleddata = [];

            $('#tblLeadLimit tbody tr').each(function () {

                //Checking for Only checked checkboxes

                $(this).find('.chkSelectClass:checkbox:checked').each(function () {


                    var row = $(this).closest('tr');
                    var columns = row.find('td');

                    $.each(columns, function (i, item) {
                        if (i > 2) {
                            values = values + "," + $(this).closest('td').find("input:text").val().trim();

                        }
                        else {
                            if (i == 0)
                                values = item.textContent;
                            else
                                values = values + "," + item.textContent.trim();
                        }



                    });
                    //saving lsit of checked item data in a Array.
                    Array.push(values);
                });
            });


            //looping through the Array  and storing in a Array list 
            $.each(Array, function (i, item) {

                required = item.split(",")


                if (required[2] == 'Default') {
                    required[2] = null;

                }


                if (required[1] == 'Local') {
                    required[1] =parseInt(@Constants.LOCAL);

                }
                else if (required[1] == 'Long') {
                    required[1] =parseInt(@Constants.LONG);

                }
                else {
                    required[1] = null;
                }


                LeadLimitData =
               [{
                   AreaCodes: required[2],
                   ServiceId: required[1],
                   LeadFrequency: required[3],
                   DailyLeadLimit: required[4],
                   MonthlyLeadLimit: required[5],
                   TotalLeadLimit: required[6]
               }]

                Filleddata.push(LeadLimitData);

            });

            //Saving the  entire data in DB with Ajax call

            if (Filleddata.length != 0) {
                $.ajax({

                    url: '/LeadLimit/LeadLimit',
                    cache: false,
                    type: 'POST',
                    dataType: "json",
                    data: JSON.stringify(Filleddata),// Comverting the list items to JSON format(Because POST method accepts  only JSON data)
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        alert('Successfully Updated:');
                        location.reload();
                    },
                    error: function () {
                        alert('Service call failed');
                    }
                });

            }
            else {
                alert("Please Select any ");
                return false;

            }

        });


        $("body #tblLeadLimit ").parent().on('change', ".chkInnerClass", function () {

            if ($(this).prop('checked') == true) {
    
                $(this).closest("td").find("input[type=text]").prop("disabled", false);
            }
            else {
                $(this).closest("td").find("input[type=text]").prop("value", "");
                $(this).closest("td").find("input[type=text]").prop("disabled", true);
            }
        });


        $("#rdbtnboth").on("change", function () {
            if ($(this).prop('checked') == true) {
                $("#txtFrequencyLocal").attr("disabled", true);
                $("#txtFrequencyLong").attr("disabled", true);
                $("#rdbtnLocal").prop("checked", false);
                $("#rdbtnLong").prop("checked", false);
            };
        });

        $("#rdbtnLocal,#rdbtnLong").on("change", function () {
            $("#rdbtnboth").prop("checked", false);
            $("#txtFrequencyboth").attr("disabled", true);

        });

        $("body #tblLeadLimit ").parent().on('change', ".chkSelectClass", function () {
            if ($(this).prop('checked') == true) {
                //Enable the frequency texboxes
                $(this).closest('tr').find(".freqEnable").attr("disabled", false);
            }
            else {
                $(this).closest('tr').find(".freqEnable").attr("disabled", true);
            }


        });



    });
</script>*@
